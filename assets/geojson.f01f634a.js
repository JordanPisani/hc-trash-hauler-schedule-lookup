import{u as P,dL as I}from"./index.b4c7b16d.js";import{s as N,t as $}from"./OptimizedGeometry.c09f520b.js";const C={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function b(t){return C[t]}function*G(t){switch(t.type){case"Feature":yield t;break;case"FeatureCollection":for(const n of t.features)n&&(yield n)}}function*J(t){if(!t)return null;switch(t.type){case"Point":yield t.coordinates;break;case"LineString":case"MultiPoint":yield*t.coordinates;break;case"MultiLineString":case"Polygon":for(const n of t.coordinates)yield*n;break;case"MultiPolygon":for(const n of t.coordinates)for(const e of n)yield*e}}function*x(t,n={}){const{geometryType:e,objectIdField:o}=n;for(const a of t){var r;const{geometry:u,properties:i,id:c}=a;if(u&&b(u.type)!==e)continue;const s=i||{};let d=(r=s[o])!=null?r:null;o&&c!=null&&!s[o]&&(s[o]=d=c),yield new N(u?R(new $,u,n):null,s,null,d)}}function A(t){for(const n of t)if(n.length>2)return!0;return!1}function D(t){return!M(t)}function E(t){return M(t)}function M(t){let n=0;for(let e=0;e<t.length;e++){const o=t[e],r=t[(e+1)%t.length];n+=o[0]*r[1]-r[0]*o[1]}return n<=0}function k(t){const n=t[0],e=t[t.length-1];return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]||t.push(n),t}function R(t,n,e){switch(n.type){case"LineString":return Z(t,n,e);case"MultiLineString":return v(t,n,e);case"MultiPoint":return B(t,n,e);case"MultiPolygon":return H(t,n,e);case"Point":return q(t,n,e);case"Polygon":return z(t,n,e)}}function Z(t,n,e){return h(t,n.coordinates,e),t}function v(t,n,e){for(const o of n.coordinates)h(t,o,e);return t}function B(t,n,e){return h(t,n.coordinates,e),t}function H(t,n,e){for(const o of n.coordinates){L(t,o[0],e);for(let r=1;r<o.length;r++)T(t,o[r],e)}return t}function q(t,n,e){return S(t,n.coordinates,e),t}function z(t,n,e){const o=n.coordinates;L(t,o[0],e);for(let r=1;r<o.length;r++)T(t,o[r],e);return t}function L(t,n,e){const o=k(n);D(o)?O(t,o,e):h(t,o,e)}function T(t,n,e){const o=k(n);E(o)?O(t,o,e):h(t,o,e)}function h(t,n,e){for(const o of n)S(t,o,e);t.lengths.push(n.length)}function O(t,n,e){for(let o=n.length-1;o>=0;o--)S(t,n[o],e);t.lengths.push(n.length)}function S(t,n,e){const[o,r,a]=n;t.coords.push(o,r),e.hasZ&&t.coords.push(a||0)}function K(t){switch(typeof t){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function V(t){if(!t)throw new P("geojson-layer:empty","GeoJSON data is empty");if(t.type!=="Feature"&&t.type!=="FeatureCollection")throw new P("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:t});const{crs:n}=t;if(!n)return;const e=typeof n=="string"?n:n.type==="name"?n.properties.name:n.type==="EPSG"?n.properties.code:null,o=new RegExp(".*(CRS84H?|4326)$","i");if(!e||!o.test(e))throw new P("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function W(t,n={}){const e=[],o=new Set,r=new Set;let a,u=!1,i=null,c=!1,{geometryType:s=null}=n,d=!1;for(const g of G(t)){const{geometry:w,properties:f,id:y}=g;if((!w||(s||(s=b(w.type)),b(w.type)===s))&&(u||(u=A(J(w))),c||(c=y!=null,c&&(a=typeof y,i=Object.keys(f).filter(p=>f[p]===y))),c&&y!=null&&(i.length>1?i=i.filter(p=>f[p]===y):i.length===1&&(i=f[i[0]]===y?i:[])),!d&&f)){let p=!0;for(const l in f){if(o.has(l))continue;const F=f[l];if(F==null){p=!1,r.add(l);continue}const j=K(F);j!=="unknown"?(r.delete(l),o.add(l),e.push({name:l,alias:l,type:j})):r.add(l)}d=p}}const m=i&&i.length===1&&i[0]||null;if(m){for(const g of e)if(g.name===m&&I(g)){g.type="esriFieldTypeOID";break}}return{fields:e,geometryType:s,hasZ:u,objectIdFieldName:m,objectIdFieldType:a,unknownFields:Array.from(r)}}function X(t,n){return Array.from(x(G(t),n))}export{X as L,V as O,W as T,b as i};
